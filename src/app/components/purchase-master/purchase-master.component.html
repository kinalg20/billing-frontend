<!-- Start Main Content Wrapper Area -->
<div class="main-content d-flex flex-column">

    <!-- Breadcrumb Area -->
    <div class="breadcrumb-area" *ngFor="let Content of breadcrumb;">
        <h3>{{Content.title}}</h3>
    </div>
    <!-- End Breadcrumb Area -->

    <!-- Start -->
    <!-- <app-product></app-product> -->
    <div class="add-listings-box1">
        <form [formGroup]="purchasingForm" (ngSubmit)="purchasingFormSubmission(formRef)" #formRef="ngForm">
            <div class="row">
                <div class="col-lg-12 col-md-12 form-group">
                    <label for="">Shop Name</label>
                    <input type="text" class="form-control" formControlName="shop_name" placeholder="Shop Name"
                        [class.is-invalid]="(formRef.submitted &&
                        purchasingForm.get('shop_name')?.invalid) ||
                        (purchasingForm.get('shop_name')?.touched &&
                        purchasingForm.get('shop_name')?.invalid)" required>
                    <div class="invalid-feedback"> Shop Name is  Required</div>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-lg-2 col-md-12 form-group">
                    <label for="">Product</label>
                    <select formControlName="product_id" class="form-control form-select" id="product"
                        [class.is-invalid]="(formRef.submitted &&
                        purchasingForm.get('product_id')?.invalid) ||
                        (purchasingForm.get('product_id')?.touched &&
                        purchasingForm.get('product_id')?.invalid)" required>
                        <option value="" disabled selected>Product</option>
                        <ng-container *ngFor="let item of products">
                            <option [value]="item?.id">{{item?.name}}</option>
                        </ng-container>
                    </select>
                    <div class="invalid-feedback"> Product is Required</div>
                </div>
                <div class="col-lg-2 col-md-12 form-group">
                    <label for="">Gross Weight</label>
                    <input type="number" min="1" class="form-control" formControlName="gross_weight"
                        placeholder="Gross Weight" [class.is-invalid]="(formRef.submitted &&
                        purchasingForm.get('gross_weight')?.invalid) ||
                        (purchasingForm.get('gross_weight')?.touched &&
                        purchasingForm.get('gross_weight')?.invalid)">
                </div>
                <div class="col-lg-2 col-md-12 form-group">
                    <label for="">Melting</label>
                    <input type="text" class="form-control" formControlName="melting" placeholder="Melting"
                        [class.is-invalid]="(formRef.submitted &&
                        purchasingForm.get('melting')?.invalid) ||
                        (purchasingForm.get('melting')?.touched &&
                        purchasingForm.get('melting')?.invalid)" >
                </div>
                <div class="col-lg-2 col-md-12 form-group">
                    <label for="">Wastage</label>
                    <input type="text" class="form-control" formControlName="wastage" placeholder="Wastage"
                        [class.is-invalid]="(formRef.submitted &&
                        purchasingForm.get('wastage')?.invalid) ||
                        (purchasingForm.get('wastage')?.touched &&
                        purchasingForm.get('wastage')?.invalid)" >
                </div>

                <div class="col-lg-2 col-md-12 form-group d-flex align-items-center">
                    <input type="checkbox" value="Less Weight" formControlName="less_weight"><span class="mx-2">Less
                        Weight</span>
                </div>

                <ng-container *ngIf="purchasingForm.controls['less_weight'].value">
                    <div class="col-lg-2 col-md-12 form-group">
                        <label for="">Small Pack Qty</label>
                        <input type="number" min="1" class="form-control" formControlName="small_pack_quantity"
                            placeholder="Small Pack Qty">
                    </div>
                    <div class="col-lg-2 col-md-12 form-group">
                        <label for="">Small Pack Wt</label>
                        <input type="number" min="1" class="form-control" formControlName="small_pack_weight"
                            placeholder="Small Pack Wt">
                    </div>
                    <div class="col-lg-2 col-md-12 form-group">
                        <label for="">Big Pack Qty</label>
                        <input type="number" min="1" class="form-control" formControlName="big_pack_quantity"
                            placeholder="Big Pack Qty">
                    </div>
                    <div class="col-lg-2 col-md-12 form-group">
                        <label for="">Big Pack Wt</label>
                        <input type="number" min="1" class="form-control" formControlName="big_pack_weight"
                            placeholder="Big Pack Wt">
                    </div>
                    <div class="col-lg-2 col-md-12 form-group">
                        <label for="">Box Wt</label>
                        <input type="number" min="1" class="form-control" formControlName="box_weight"
                            placeholder="Box Wt">
                    </div>
                    <div class="col-lg-2 col-md-12 form-group">
                        <label for="">Box Qty</label>
                        <input type="number" min="1" class="form-control" formControlName="box_quantity"
                            placeholder="Box Qty">
                    </div>
                </ng-container>
                
                <div class="col-lg-2 col-md-12 form-group">
                    <label for="">Labour</label>
                    <input type="number" min="1" class="form-control" formControlName="labour" placeholder="Labour"
                        [class.is-invalid]="(formRef.submitted &&
                        purchasingForm.get('labour')?.invalid) ||
                        (purchasingForm.get('labour')?.touched &&
                        purchasingForm.get('labour')?.invalid)" >
                </div>
                <div class="col-lg-2 col-md-12 form-group" *ngIf="purchasingForm.get('labour_by')?.value == 'piece'">
                    <label for="">Piece Qty</label>
                    <input type="number" min="1" class="form-control" formControlName="piece_quantity"
                        placeholder="Piece Qty" [class.is-invalid]="(formRef.submitted &&
                        purchasingForm.get('piece_quantity')?.invalid) ||
                        (purchasingForm.get('piece_quantity')?.touched &&
                        purchasingForm.get('piece_quantity')?.invalid)">
                </div>
                <div class="col-lg-2 col-md-12 form-group">
                    <label for="">Labour By</label>
                    <select formControlName="labour_by" class="form-control form-select" [class.is-invalid]="(formRef.submitted &&
                    purchasingForm.get('labour_by')?.invalid) ||
                    (purchasingForm.get('labour_by')?.touched &&
                    purchasingForm.get('labour_by')?.invalid)" >
                        <option value="" disabled>Labour By</option>
                        <ng-container *ngFor="let value of labour_dropdown">
                            <option [value]="value.actualValue">{{value.value}}</option>
                        </ng-container>
                    </select>
                </div>
                <div class="col-lg-2 col-md-12 form-group">
                    <label for="">Gold Rate</label>
                    <input type="number" min="1" class="form-control" formControlName="gold_rate"
                        placeholder="Gold Rate" [class.is-invalid]="(formRef.submitted &&
                        purchasingForm.get('gold_rate')?.invalid) ||
                        (purchasingForm.get('gold_rate')?.touched &&
                        purchasingForm.get('gold_rate')?.invalid)" >
                </div>
                <div class="col-lg-2 col-md-12 form-group">
                    <label for="">Net Weight</label>
                    <span class="form-control">{{getNetWeight('net weight')}}</span>
                </div>
                <div class="col-lg-2 col-md-12 form-group">
                    <label for="">Rate</label>
                    <span class="form-control">{{getNetWeight('rate')}}</span>
                </div>
                <div class="col-lg-2 col-md-12 form-group">
                    <label for="">Fine</label>
                    <span class="form-control">{{getNetWeight('fine')}}</span>
                </div>
                <div class="col-lg-2 col-md-12 form-group">
                    <label for="">Total Labour</label>
                    <span class="form-control">{{getNetWeight('total_labour')}}</span>
                </div>
                <div class="add-listings-btn col-lg-12 col-md-12 my-2" style="text-align: right;">
                    <div class="form-group">
                        <button type="submit" class="submit_btn m-0">{{addButton}}</button>
                    </div>
                </div>
            </div>
        </form>

        <div style="overflow-x: auto;">
            <table class="table-bordered w-100 table">
                <thead>
                    <tr>
                        <th>Shop Name</th>
                        <th>Product Name</th>
                        <th>Gross Weight</th>
                        <th>Melting</th>
                        <th>Wastage</th>
                        <th>Small Pack Weight</th>
                        <th>Small Pack Qty</th>
                        <th>Big Pack Weight</th>
                        <th>Big Pack Qty</th>
                        <th>Box Weight</th>
                        <th>Box Qty</th>
                        <th>Labour</th>
                        <th>Labour By</th>
                        <th>Total Labour</th>
                        <th>Piece Quantity</th>
                        <th>Gold Rate</th>
                        <th>Net Weight</th>
                        <th>Rate</th>
                        <th>Fine</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody *ngFor="let product of totalRows; index as index;">
                    <tr>
                        <td>{{product.shop_name}}</td>
                        <td>
                            <ng-container *ngFor="let productname of products">
                                <span *ngIf="productname.id == product.product_id">{{productname.name}}</span>
                            </ng-container></td>
                        <td>{{product.gross_weight ?? 0}}</td>
                        <td>{{product.melting ?? 0}}</td>
                        <td>{{product.wastage ?? 0}}</td>
                        <td>{{product.small_pack_weight ? product.small_pack_weight : 0}}</td>
                        <td>{{product.small_pack_quantity ? product.small_pack_quantity : 0}}</td>
                        <td>{{product.big_pack_weight ? product.big_pack_weight : 0}}</td>
                        <td>{{product.big_pack_quantity ? product.big_pack_quantity : 0}}</td>
                        <td>{{product.box_weight ? product.box_weight : 0}}</td>
                        <td>{{product.box_quantity ? product.box_quantity : 0}}</td>
                        <td>{{product.labour ?? 0}}</td>
                        <td>{{product.labour_by ?? 0}}</td>
                        <td>{{product.total_labour ?? 0}}</td>
                        <td>{{product.piece_quantity ? product.piece_quantity : 0}}</td>
                        <td>{{product.gold_rate ?? 0}}</td>
                        <td>{{product.net_weight ?? 0}}</td>
                        <td>{{product.rate ?? 0}}</td>
                        <td>{{product.fine ?? 0}}</td>
                        <td style="cursor: pointer; display: flex; justify-content: space-between;">
                            <i (click)="EditForm(index , 'edit')" class="mb-3 pi pi-pencil text-2xl text-color-secondary"></i>
                            <i (click)="EditForm(index , 'delete')" class="mb-3 pi pi-trash text-2xl text-color-secondary"></i>
                        </td>   
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="add-listings-btn col-lg-12 col-md-12 d-flex mt-1 justify-content-end">
            <div class="form-group">
                <button type="button" class="submit_btn mt-0" (click)="submitApi(formRef)">Submit</button>
            </div>
        </div>
        <div style="text-align: right; margin: 20px 0;">
            <span>Total Fine : {{getAmount('total_fine')}}</span><br>
            <span>Gold Bhav : {{getAmount('gold_bhav')}}</span><br>
            <span>Payment : {{getAmount('payment') | number}}</span><br>
        </div>
    </div>
</div>